---
title: MD5算法详解
date: 2021-06-07 15:01:15
tags:
- MD5
- 算法
categories:
- 网络
---

> 引用：[.NET云原生](https://www.cnblogs.com/JulianHuang/p/14858339.html#%E5%8A%A0%E5%AF%86%E7%AE%97%E6%B3%95)
>
> 去掉敏感字眼，其他内容与引用一致，供个人学习！

<!--more-->



MD5不是加密算法，是摘要算法。

加密算法、摘要算法的定义和场景：
![](https://img.api.liujinshui.com/e90b3312-121d-4654-9a7f-9db4269af3d6.png)

加密算法的目的，在于使别人无法成功查看加密的数据，并且在需要的时候还可以对数据进行解密来重新查看数据。

而MD5算法是一种哈希算法，哈希算法的设计目的本身就决定了，它在大多数情况下都是不可逆的，即你通过哈希算法得到的数据，无法经过任何算法还原回去。 所以既然不能将数据还原，也就不能称之为解密；既然不能解密，那么哈希的过程自然也就不能称作是[加密]了。

## 加密算法

**加密**： 是以某种特殊的算法改变原有的信息，使得未授权的用户即使获得已加密的信息，但因不知解密的方法，仍然无法了解信息的内容。

**解密**：加密的逆过程为解密，即将该加密信息转化为其原来信息的过程。

加密算法分为对称加密和非对称加密，其中对称加密算法的加解密密钥相同，非对称加解密的密钥不同。

![](https://img.api.liujinshui.com/03cecdbf-3e8b-4427-804a-6e2100c7b10b.png)

> HTTPS就同时用到非对称加密和对称加密，在连接建立的阶段，使用非对称加解密(传输密钥)， 在通信阶段使用对称密钥加解密数据。

![](https://img.api.liujinshui.com/20896856-48d4-4771-9701-eecdcafb7c35.png)

## 摘要算法

摘要算法，又称哈希算法、散列算法。通过一个函数，将任意长度的内容转换为一个固定长度的数据串。

![](https://img.api.liujinshui.com/08114dbc-c995-4e18-bfa6-2cfe3e65cde8.png)

摘要算法之所以能指出数据是否被篡改，就是因为摘要函数是一个单向函数，计算很容易，但通过摘要(digest) 反推data却非常困难，而且，对于原始数据做一个bit的修改，都会导致计算出的摘要完全不同。

> 使用迅雷下载某片的时候，下载站会顺带给你一个MD5校验码；
> 你找一个MD5校验工具，对下载下来的文件执行MD5算法，将得到的哈希值与下载站附带的MD5值对比，如果值是相同的，说明从该网站下载的文件没有损坏。

### HMAC

延伸聊一个结合了密钥和哈希功能的请求认证方案：
HMAC ( hash-based message authenticated code)

很多第三方平台都采用这种授权认证方案，你回想一下，api平台是不是经常给你一对`AppID` `Serect Key`

1. Client & Server 都知晓一个私钥`serect key`
2. 客户端每次请求时，会针对(请求数据+ secret key)生成一个hash值
   `HMAC = hashFunc(secret key + message)`
3. 客户端将哈希值做为请求的一部分，一起发送
4. 当服务端收到请求， 对( 收到的请求+ 查到的`Serectkey'`)生成哈希，将计算的哈希值与请求中附带的原哈希值对比，如果相同，则认定请求来自受信Client，且请求未被篡改。

为什么会有这样的效果？

首先：Client 和Server的哈希值相同，根据哈希算法的设计初衷，说明请求过程未被篡改；

另一方面也反推 Client 和Server使用了相同的`Serect Key` , 而`Serect Key`是私密信息，故此处的Client不可抵赖。

> 还可以考虑在客户端生成哈希时加入timestamp时间戳（请求还要附带这个时间戳），服务端收到后先对比服务器时间戳与请求时间戳，限制15s内为有效请求，再对（请求信息+ 时间戳+ serectkey)哈希对比，避免重放攻击。

## 总结

本文给出的示例： HTTPS、迅雷MD5校验，足够帮助你了解加密算法和摘要算法的设计目的。

- 加密算法的目的是： 防止信息被偷看
- 摘要算法的目的是： 防止信息被篡改

以后使用时候也能有的放矢，面试时也不会闹出笑话。

最后给出的WebAPI授权方案`HMAC`，算是密钥+哈希算法结合的一个应用场景， 具备快速、自签名的特点。
